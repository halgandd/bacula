#
#  Version $Id$
#
@MCOMMON@

srcdir =	.
VPATH = 	.
.PATH:		.

# one up
basedir = ..
# top dir
topdir = ../..
# this dir relative to top dir
thisdir = src/wx-console

DEBUG=@DEBUG@

first_rule: all
dummy:

#
CONSSRCS = main.cpp console_thread.cpp authenticate.c console_conf.c wxbrestorepanel.cpp \
	     wxbmainframe.cpp wxbtableparser.cpp wxbtreectrl.cpp wxblistctrl.cpp wxbutils.cpp \
	     wxbconfigpanel.cpp
CONSOBJS = main.o console_thread.o authenticate.o console_conf.o wxbrestorepanel.o \
	     wxbmainframe.o wxbtableparser.o wxbtreectrl.o wxblistctrl.o wxbutils.o \
	     wxbconfigpanel.o

win32 = wx-console_private.res

WIN32RES = $(@WIN32@)

# these are the objects that are changed by the .configure process
EXTRAOBJS = @OBJLIST@

# wx-config generated by configure
CONS_CPPFLAGS=@WXCONS_CPPFLAGS@
CONS_LDFLAGS=@WXCONS_LDFLAGS@

.SUFFIXES:     .cpp .c .o
.PHONY:
.DONTCARE:

# inference rules
.c.o:
	$(CXX) $(DEFS) $(DEBUG) -c $(CPPFLAGS) $(CONS_CPPFLAGS) $(CONS_INC) -I$(srcdir) \
	   -I$(basedir) $(DINCLUDE) $(WCFLAGS) $(CFLAGS) $<

.cpp.o:
	$(CXX) $(DEFS) $(DEBUG) -c $(CPPFLAGS) $(CONS_CPPFLAGS) $(CONS_INC) -I$(srcdir) \
	   -I$(basedir) $(DINCLUDE) $(WCFLAGS) $(CFLAGS) $<


#-------------------------------------------------------------------------
all: Makefile wx-console
	@echo "==== Make of wx-console is good ===="
	@echo " "

# Mac OS X application bundle
# See http://216.239.59.104/search?q=cache:a61SGKgoHSQJ:wiki.wxwidgets.org/wiki.pl%3FWxMac_Issues+wxmac+%22application+bundle%22&hl=fr

wx-console.app: wx-console
	-mkdir wx-console.app    
	-mkdir wx-console.app/Contents
	-mkdir wx-console.app/Contents/MacOS
	-mkdir wx-console.app/Contents/Resources
	-mkdir wx-console.app/Contents/Resources/English.lproj
	echo -n 'APPL????' > wx-console.app/Contents/PkgInfo
	mv wx-console wx-console.app/Contents/MacOS/wx-console
	cp wx-console.conf wx-console.app/Contents/MacOS/wx-console.conf

wx-console: $(CONSOBJS) @WIN32@ ../lib/libbac.a
	$(CXX) $(CONSOBJS) $(WIN32RES) -o $@ $(LIBS) -L../lib $(CONS_LDFLAGS) -lbac

win32: wx-console_private.res
	

wx-console_private.res: wx-console_private.rc 
	windres.exe -i wx-console_private.rc -I rc -o wx-console_private.res -O coff 

clean:
	@$(RMF) $(CONSOBJS) wx-console $(WIN32RES)

distclean: clean
	$(RMF) Makefile
	$(RMF) -r CVS

Makefile: $(srcdir)/Makefile.in $(topdir)/config.status
	cd $(topdir) \
	  && CONFIG_FILES=$(thisdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status

install: all
	$(INSTALL_PROGRAM) wx-console $(DESTDIR)$(sbindir)/wx-console
	@srcconf=wx-console.conf; \
	if  test -f ${DESTDIR}${sysconfdir}/$$srcconf; then \
	   destconf=$$srcconf.new; \
	   echo "  ==> Found existing $$srcconf, installing new conf file as $$destconf"; \
	else \
	   destconf=$$srcconf; \
	fi; \
	echo "${INSTALL_CONFIG} $$srcconf ${DESTDIR}${sysconfdir}/$$destconf"; \
	${INSTALL_CONFIG} $$srcconf ${DESTDIR}${sysconfdir}/$$destconf

uninstall:
	(cd $(DESTDIR)$(sbindir); $(RMF) wx-console)
	(cd $(DESTDIR)$(sysconfdir); $(RMF) wx-console.conf wx-console.conf.new)

# Semi-automatic generation of dependencies:
# Use gcc -MM because X11 `makedepend' doesn't work on all systems
# and it also includes system headers.
# `semi'-automatic since dependencies are generated at distribution time.

depend:
	@$(MV) Makefile Makefile.bak
	@$(SED) "/^# DO NOT DELETE:/,$$ d" Makefile.bak > Makefile
	@$(ECHO) "# DO NOT DELETE: nice dependency list follows" >> Makefile
	@$(CC) -S -M $(CPPFLAGS) $(CONS_CPPFLAGS) -I$(srcdir) -I$(basedir) $(CONSSRCS) >> Makefile
	@if test -f Makefile ; then \
	    $(RMF) Makefile.bak; \
	else \
	   $(MV) Makefile.bak Makefile; \
	   echo -e "Something went wrong\n\a"; \
	fi

# -----------------------------------------------------------------------
# DO NOT DELETE: nice dependency list follows
