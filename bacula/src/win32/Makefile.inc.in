#
# Makefile for win32 bacula executables
# Using MinGW cross-compiler on GNU/Linux
#
#  Written by Robert Nelson, June 2006
#

# Global Configuration

ECHO_CMD = @

BUILDDIR := @BUILDDIR@
TOPDIR := @TOPDIR@
DEPKGS := $(TOPDIR)/depkgs-mingw32

DOCDIR := $(TOPDIR)/docs
BINDIR := ../release
LIBDIR := ../release
OBJDIR := .

MINGW_BIN := @BINDIR@
MINGW_INCLUDE := @INCDIR@
MINGW_DLLDIR := @DLLDIR@

CC = $(MINGW_BIN)/mingw32-g++ $(DEFINES) $(INCLUDES)
CXX = $(MINGW_BIN)/mingw32-g++ $(DEFINES) $(INCLUDES)
AR := $(MINGW_BIN)/mingw32-ar
RANLIB := $(MINGW_BIN)/mingw32-ranlib
WINDRES := $(MINGW_BIN)/mingw32-windres
DLLTOOL := $(MINGW_BIN)/../mingw32/bin/dlltool
OBJCPY := $(MINGW_BIN)/mingw32-objcopy
NSIS_DIR := $(DEPKGS)/nsis
STAB2CV := $(DEPKGS)/tools/bin/stab2cv

CFLAGS := -g -Wall -mno-cygwin -m32 -mwin32 -mthreads -O3 -fno-strict-aliasing
LDFLAGS := -g -Wall -mno-cygwin -Wl,--disable-auto-import

INCLUDE_DDK := -I$(MINGW_INCLUDE)/ddk
INCLUDE_BACULA := -I../.. -I../compat
INCLUDE_PTHREADS := -I$(DEPKGS)/include/pthreads
INCLUDE_ZLIB := -I$(DEPKGS)/include
INCLUDE_VSS := -I$(DEPKGS)/vss
INCLUDE_ICONS := -I../libwin32
INCLUDE_OPENSSL := -I$(DEPKGS)/include
INCLUDE_WX := -I$(DEPKGS)/lib/wx_dll/msw -I$(DEPKGS)/include
INCLUDE_MYSQL := -I$(DEPKGS)/include/mysql

LIBS_PTHREADS := \
        $(DEPKGS)/lib/libpthreadGCE.a

LIBS_ZLIB := \
        $(DEPKGS)/lib/libz.a

LIBS_MYSQL := \
        $(DEPKGS)/lib/libmysql.a

LIBS_POSTGRESQL := \
        $(DEPKGS)/lib/libpq.a

LIBS_SQLITE := \
        $(DEPKGS)/lib/libsqlite3.a

LIBS_SSL := \
        $(DEPKGS)/lib/libssl.dll.a

LIBS_CRYPTO := \
        $(DEPKGS)/lib/libcrypto.dll.a

LIBS_WX := \
        $(DEPKGS)/lib/wx_dll/libwxmsw28_core.a \
        $(DEPKGS)/lib/wx_dll/libwxbase28.a

LIBS_CATS := \
        $(LIBDIR)/libcats.a

LIBS_BACULA := \
        $(LIBDIR)/libbacula.a

HAVES := \
        -DHAVE_WIN32 \
        -DHAVE_MINGW \
        -DHAVE_ZLIB_H \
        -DHAVE_LIBZ \
        -DHAVE_CRYPTO \
        -DHAVE_OPENSSL \
        -DHAVE_TLS
